<!DOCTYPE html>
<meta charset="utf-8">
<style>

    body {
        font: 10px sans-serif;
    }

    .chord {
        fill-opacity: .67;
    }
    text{
       font-family: "Malgun Gothic";
    }
    .tooltip{
        position: absolute;
        width: 120;
        height: auto;
        font-family: simsun;
        font-size: 14px;
        text-align: center;
        color: white;
        border-style: solid;
        border-width: 2px;
        background-color: black;
        border-radius: 5px;
    }
    .tooltip:after{
        content: '';
        position: absolute;
        bottom: 100%;
        left:20%;
        margin-left: -8px;
        width: 0;
        height: 0;
        border-bottom: 12px solid #000000;
        border-right: 12px solid transparent;
        border-left: 12px solid transparent;
        box-shadow: h-shadow v-shadow blur spread color inset;
    }
</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
    var geno_name = ["ABLIM1","ACVR1C","APAF1","C13orf30","C15orf33","C3orf21","C5orf32","CA10","CCDC46","CNTNAP2","COX5B","DTX4","FAM124A","FAM20B","GABRG3","GOLPH3L","IGF2R","KCNH5","KRTAP507","KRTAP508","LINGO1","MAP3K8","MBD5","MYO18B","OR2L13","PHLPP1","PKNOX1","PPP3CA","PRR5L","ST20","TXNDC12","UBAC2","USP32","VWC2L","WDR64"];
    var geno_real = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
        [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ];

    var outerRadius = 800 / 2,//外部半径
     innerRadius = outerRadius - 130;//内部半径


    var fill = d3.scale.category20();//构造一个另外20种颜色的序数比例尺。

    var chord = d3.layout.chord()//layout(布局)方法；从关系矩阵生成一个弦图
            .padding(.04)//距离
            .sortSubgroups(d3.descending)//取得或设置用于子分组的比较器。
            .sortChords(d3.descending)
            .matrix(geno_real);//为排序比较两个值。

    console.log("groups",chord.groups());
    console.log("chords",chord.chords());

    var arc = d3.svg.arc()
            .innerRadius(innerRadius)
            .outerRadius(innerRadius + 20);

    var svg = d3.select("body").append("svg")
            .attr("width", outerRadius * 3)
            .attr("height", outerRadius * 2)
            .append("g")
            .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

    var g = svg.selectAll(".group")
            .data(chord.groups)
            .enter().append("g")
            .attr("class", "group");

    var legend = g.append("path")
            .style("fill", function(d) { return fill(d.index); })
            .style("stroke", function(d) { return fill(d.index); })
            .attr("d", arc);

    var text = g.selectAll("text")
            .data(chord.groups)
            .enter()
            .append("text")
            .each(function(d,i) {
                d.angle = (d.startAngle + d.endAngle) / 2;
                d.name = geno_name[i];
            })//开始弧度与结束弧度
            .attr("dy", ".35em")
            .attr("transform", function(d) {
                return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                        + "translate(" + (innerRadius + 26) + ")"
                        + (d.angle > Math.PI ? "rotate(180)" : "");
            })
            .style("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
            .text(function(d) { return d.name; });

    var chord_ = svg.selectAll(".chord")
            .data(chord.chords)
            .enter().append("path")
            .attr("class", "chord")
//            .style("stroke", function(d) { return d3.rgb(fill(d.source.index)).darker(); })
            .style("fill", function(d) { return fill(d.source.index); })
            .attr("d", d3.svg.chord().radius(innerRadius));


    d3.select(self.frameElement).style("height", outerRadius * 2 + "px");
    var tooltip = d3.select("body").append("div")
            .attr("class","tooltip")
            .style("opacity",0.0);

    chord_.on("mouseover",function(d,i){
                var selIndex = d.source.index;
                /*
                 鼠标移入时，
                 （1）通过 selection.html() 来更改提示框的文字
                 （2）通过更改样式 left 和 top 来设定提示框的位置
                 （3）设定提示框的透明度为1.0（完全不透明）
                 */
        function cls(){
                if(d.source.value==1){
                    return "CTX"
                }else if(d.source.value==2){
                    return "INV"
                }else{
                    return "DUP"
                }
        }

        var iArr = [];
        chord_.style("fill", function(d) {
            if(d.source.index == selIndex || d.source.subindex == selIndex && d.source.value!=0){
                iArr.push(d.source.subindex);
                iArr.push(d.source.index);
                return "gold";
            }else{
                return fill("rgba(0.0.0.0)");
            }
        });
        console.log(iArr);

        text.style("fill",function (d) {
            for(var i=0;i<iArr.length;i++){
                if(d.index == selIndex || d.index == iArr[i]){
                    return "red";
                }
            }
        });

        legend.style("fill", function(d) {
            for(var i=0;i<iArr.length;i++){
                    if(d.index == selIndex || d.index == iArr[i]){
                        return fill(d.index);
                    }
                }
        })
                .style("stroke", function(d) {
                    for(var i=0;i<iArr.length;i++){
                        if(d.index == selIndex || d.index == iArr[i]){
                            return fill(d.index);
                        }
                    }
                })
                .attr("d", arc);

        tooltip.html("GenoName:"+geno_name[d.source.index]+"<br/>"+"GenoName:"+geno_name[d.source.subindex]+"<br/>"+ "Class:"+cls())
                .style("left", (d3.event.pageX) + "px")
                .style("top", (d3.event.pageY + 20) + "px")
                .style("opacity",1.0);
        /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */
        d3.select(this).style("fill","gold");

        tooltip.style("left", (d3.event.pageX) + "px")
                .style("top", (d3.event.pageY + 20) + "px");
            });

    chord_.on("mouseout",function(d){
                /* 鼠标移出时，将透明度设定为0.0（完全透明）*/
        chord_.style("fill", function(d) {
                return fill(d.source.index)
        });
        d3.select(this)
                .transition()
//                        .duration(500)
                .style("fill",function(d) { return fill(d.source.index); });
        tooltip.style("opacity",0.0);
        text.style("fill","#000");
        legend.style("fill", function(d) { return fill(d.index); })
                .style("stroke", function(d) { return fill(d.index); })
                .attr("d", arc);
            });
</script>
